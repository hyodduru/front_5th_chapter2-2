import{r as g,j as e,c as q,R as T}from"./client-DD4c7S6m.js";const F=t=>{const{quantity:s,product:a}=t,n=a.discounts.filter(d=>s>=d.quantity).map(d=>d.rate);return n.length>0?Math.max(...n):0},I=t=>{const s=F(t);return t.product.price*(1-s)*t.quantity},V=(t,s)=>{const a=t.reduce((u,p)=>u+p.product.price*p.quantity,0),n=t.reduce((u,p)=>u+I(p),0);let d=0;s&&(s.discountType==="amount"?d=s.discountValue:s.discountType==="percentage"&&(d=n*(s.discountValue/100)));const o=a-n+d,c=a-o;return{totalBeforeDiscount:Math.floor(a),totalDiscount:Math.floor(o),totalAfterDiscount:Math.max(0,Math.floor(c))}},A=(t,s,a)=>t.find(d=>d.product.id===s)?t.map(d=>d.product.id===s?{...d,quantity:Math.min(Math.max(a,0),d.product.stock)}:d).filter(d=>d.quantity>0):t,R=(t,s)=>{const a=s.find(n=>n.product.id===t.id);return t.stock-((a==null?void 0:a.quantity)||0)},E=t=>{const{discounts:s}=t.product,{quantity:a}=t;let n=0;for(const d of s)a>=d.quantity&&(n=Math.max(n,d.rate));return n};function M(t,s){const[a,n]=g.useState(()=>{try{const d=localStorage.getItem(t);return d?JSON.parse(d):s}catch(d){return console.warn("로컬스토리지 불러오기 오류:",d),s}});return g.useEffect(()=>{try{localStorage.setItem(t,JSON.stringify(a))}catch(d){console.warn("로컬스토리지 저장 오류:",d)}},[t,a]),[a,n]}const $=()=>{const[t,s]=M("cart",[]),[a,n]=g.useState(null);return{cart:t,addToCart:i=>{s(b=>{const h=b.find(r=>r.product.id===i.id),y=(h==null?void 0:h.quantity)??0;return!h&&i.stock>0?[...b,{product:i,quantity:1}]:y>=i.stock?b:A(b,i.id,y+1)})},removeFromCart:i=>{s(b=>b.filter(h=>h.product.id!==i))},updateQuantity:(i,b)=>{s(h=>{var f;return((f=h.find(v=>v.product.id===i))==null?void 0:f.product)?A(h,i,b):h})},applyCoupon:i=>{n(i)},calculateTotal:()=>V(t,a),selectedCoupon:a,getRemainingStock:i=>R(i,t)}},L=({item:t,removeFromCart:s,updateQuantity:a})=>{const{price:n}=t.product,d=E(t);return e.jsxs("div",{className:"flex justify-between items-center bg-white p-3 rounded shadow",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:t.product.name}),e.jsx("br",{}),e.jsxs("span",{className:"text-sm text-gray-600",children:[n,"원 x ",t.quantity,d>0&&e.jsxs("span",{className:"text-green-600 ml-1",children:["(",(d*100).toFixed(0),"% 할인 적용)"]})]})]}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>a(t.product.id,t.quantity-1),className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:"-"}),e.jsx("button",{onClick:()=>a(t.product.id,t.quantity+1),className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:"+"}),e.jsx("button",{onClick:()=>s(t.product.id),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]})]},t.product.id)},U=({cart:t,removeFromCart:s,updateQuantity:a})=>e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"장바구니 내역"}),e.jsx("div",{className:"space-y-2",children:t.map((n,d)=>e.jsx(L,{item:n,removeFromCart:s,updateQuantity:a},d))})]}),B=t=>t.reduce((s,a)=>Math.max(s,a.rate),0),O=({product:t,remainingStock:s,addToCart:a})=>{const{id:n,name:d,price:o,discounts:c}=t;return e.jsxs("div",{"data-testid":`product-${n}`,className:"bg-white p-3 rounded shadow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-semibold",children:d}),e.jsxs("span",{className:"text-gray-600",children:[o.toLocaleString(),"원"]})]}),e.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:[e.jsxs("span",{className:`font-medium ${s>0?"text-green-600":"text-red-600"}`,children:["재고: ",s,"개"]}),c.length>0&&e.jsxs("span",{className:"ml-2 font-medium text-blue-600",children:["최대 ",(B(c)*100).toFixed(0),"% 할인"]})]}),c.length>0&&e.jsx("ul",{className:"list-disc list-inside text-sm text-gray-500 mb-2",children:c.map(({quantity:u,rate:p},N)=>e.jsxs("li",{children:[u,"개 이상: ",(p*100).toFixed(0),"% 할인"]},N))}),e.jsx("button",{onClick:()=>a(t),className:`w-full px-3 py-1 rounded ${s>0?"bg-blue-500 text-white hover:bg-blue-600":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,disabled:s<=0,children:s>0?"장바구니에 추가":"품절"})]},n)},Q=({products:t,addToCart:s,getRemainingStock:a})=>e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"상품 목록"}),e.jsx("div",{className:"space-y-2",children:t.map(n=>{const d=a(n);return e.jsx(O,{product:n,remainingStock:d,addToCart:s},n.id)})})]}),J=({coupons:t,applyCoupon:s,selectedCoupon:a})=>e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"쿠폰 적용"}),e.jsxs("select",{onChange:n=>s(t[parseInt(n.target.value)]),className:"w-full p-2 border rounded mb-2",children:[e.jsx("option",{value:"",children:"쿠폰 선택"}),t.map((n,d)=>e.jsxs("option",{value:d,children:[n.name," -"," ",n.discountType==="amount"?`${n.discountValue}원`:`${n.discountValue}%`]},n.code))]}),a&&e.jsxs("p",{className:"text-green-600",children:["적용된 쿠폰: ",a.name,"(",a.discountType==="amount"?`${a.discountValue}원`:`${a.discountValue}%`," ","할인)"]})]}),W=({calculateTotal:t})=>{const{totalBeforeDiscount:s,totalAfterDiscount:a,totalDiscount:n}=t();return e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"주문 요약"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{children:["상품 금액: ",s.toLocaleString(),"원"]}),e.jsxs("p",{className:"text-green-600",children:["할인 금액: ",n.toLocaleString(),"원"]}),e.jsxs("p",{className:"text-xl font-bold",children:["최종 결제 금액: ",a.toLocaleString(),"원"]})]})]})},_=({products:t,coupons:s})=>{const{cart:a,addToCart:n,getRemainingStock:d,calculateTotal:o,applyCoupon:c,selectedCoupon:u,removeFromCart:p,updateQuantity:N}=$();return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"장바구니"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(Q,{products:t,addToCart:n,getRemainingStock:d}),e.jsxs("div",{children:[e.jsx(U,{cart:a,removeFromCart:p,updateQuantity:N}),e.jsx(J,{coupons:s,applyCoupon:c,selectedCoupon:u}),e.jsx(W,{calculateTotal:o})]})]})]})},z=({newProduct:t,handleNewProductFieldChange:s,handleAddNewProduct:a})=>e.jsxs("div",{className:"bg-white p-4 rounded shadow mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"새 상품 추가"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productName",className:"block text-sm font-medium text-gray-700",children:"상품명"}),e.jsx("input",{id:"productName",type:"text",value:t.name,onChange:n=>s("name",n.target.value),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productPrice",className:"block text-sm font-medium text-gray-700",children:"가격"}),e.jsx("input",{id:"productPrice",type:"number",value:t.price,onChange:n=>s("price",parseInt(n.target.value)),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productStock",className:"block text-sm font-medium text-gray-700",children:"재고"}),e.jsx("input",{id:"productStock",type:"number",value:t.stock,onChange:n=>s("stock",parseInt(n.target.value)),className:"w-full p-2 border rounded"})]}),e.jsx("button",{onClick:a,className:"w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"추가"})]}),G=({product:t,toggleProductAccordion:s,openProductIds:a,editingProduct:n,handleProductNameUpdate:d,handlePriceUpdate:o,handleRemoveDiscount:c,handleAddDiscount:u,handleEditComplete:p,handleStockUpdate:N,handleEditProduct:i,handleNewDiscountFieldChange:b,newDiscount:h,"data-testid":y})=>e.jsxs("div",{className:"bg-white p-4 rounded shadow","data-testid":y,children:[e.jsxs("button",{"data-testid":"toggle-button",onClick:()=>s(t.id),className:"w-full text-left font-semibold",children:[t.name," - ",t.price,"원 (재고: ",t.stock,")"]}),a.has(t.id)&&e.jsx("div",{className:"mt-2",children:n&&n.id===t.id?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"상품명: "}),e.jsx("input",{type:"text",value:n.name,onChange:r=>d(t.id,r.target.value),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"가격: "}),e.jsx("input",{type:"number",value:n.price,onChange:r=>o(t.id,parseInt(r.target.value)),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"재고: "}),e.jsx("input",{type:"number",value:n.stock,onChange:r=>N(t.id,parseInt(r.target.value)),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold mb-2",children:"할인 정보"}),n.discounts.map((r,f)=>e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{children:[r.quantity,"개 이상 구매 시 ",r.rate*100,"% 할인"]}),e.jsx("button",{onClick:()=>c(t.id,f),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]},f)),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"number",placeholder:"수량",value:h.quantity,onChange:r=>b("quantity",parseInt(r.target.value)||0),className:"w-1/3 p-2 border rounded"}),e.jsx("input",{type:"number",placeholder:"할인율 (%)",value:isNaN(h.rate*100)?0:h.rate*100,onChange:r=>b("rate",parseInt(r.target.value)||0),className:"w-1/3 p-2 border rounded"}),e.jsx("button",{onClick:()=>u(t.id),className:"w-1/3 bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"할인 추가"})]})]}),e.jsx("button",{onClick:p,className:"bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 mt-2",children:"수정 완료"})]}):e.jsxs("div",{children:[t.discounts.map((r,f)=>e.jsx("div",{className:"mb-2",children:e.jsxs("span",{children:[r.quantity,"개 이상 구매 시 ",r.rate*100,"% 할인"]})},f)),e.jsx("button",{"data-testid":"modify-button",onClick:()=>i(t),className:"bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 mt-2",children:"수정"})]})})]},t.id);function H({products:t,onProductUpdate:s,onProductAdd:a}){const[n,d]=g.useState(new Set),[o,c]=g.useState(null),[u,p]=g.useState({quantity:0,rate:0}),[N,i]=g.useState(!1),[b,h]=g.useState({name:"",price:0,stock:0,discounts:[]});return{openProductIds:n,toggleProductAccordion:l=>{d(x=>{const m=new Set(x);return m.has(l)?m.delete(l):m.add(l),m})},editingProduct:o,handleEditProduct:l=>{c({...l})},handleProductNameUpdate:(l,x)=>{(o==null?void 0:o.id)===l&&c({...o,name:x})},handlePriceUpdate:(l,x)=>{(o==null?void 0:o.id)===l&&c({...o,price:x})},handleStockUpdate:(l,x)=>{const m=t.find(j=>j.id===l);if(m){const j={...m,stock:x};s(j),c(j)}},handleEditComplete:()=>{o&&(s(o),c(null))},newDiscount:u,handleAddDiscount:l=>{const x=t.find(m=>m.id===l);if(x&&o){const m={...x,discounts:[...x.discounts,u]};s(m),c(m),p({quantity:0,rate:0})}},handleRemoveDiscount:(l,x)=>{const m=t.find(j=>j.id===l);if(m){const j={...m,discounts:m.discounts.filter((le,D)=>D!==x)};s(j),c(j)}},showNewProductForm:N,setShowNewProductForm:i,newProduct:b,handleAddNewProduct:()=>{const l={...b,id:Date.now().toString()};a(l),h({name:"",price:0,stock:0,discounts:[]}),i(!1)},handleNewProductFieldChange:(l,x)=>{h(m=>({...m,[l]:x}))},handleNewDiscountFieldChange:(l,x)=>{const m=l==="rate"?x/100:x;p(j=>({...j,[l]:m}))}}}const K=({products:t,onProductUpdate:s,onProductAdd:a})=>{const{openProductIds:n,toggleProductAccordion:d,editingProduct:o,handleEditProduct:c,handleProductNameUpdate:u,handlePriceUpdate:p,handleStockUpdate:N,handleEditComplete:i,newDiscount:b,handleAddDiscount:h,handleRemoveDiscount:y,showNewProductForm:r,setShowNewProductForm:f,newProduct:v,handleAddNewProduct:P,handleNewProductFieldChange:w,handleNewDiscountFieldChange:k}=H({products:t,onProductUpdate:s,onProductAdd:a});return e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"상품 관리"}),e.jsx("button",{onClick:()=>f(!r),className:"bg-green-500 text-white px-4 py-2 rounded mb-4 hover:bg-green-600",children:r?"취소":"새 상품 추가"}),r&&e.jsx(z,{newProduct:v,handleNewProductFieldChange:w,handleAddNewProduct:P}),e.jsx("div",{className:"space-y-2",children:t.map((C,S)=>e.jsx(G,{product:C,toggleProductAccordion:d,openProductIds:n,editingProduct:o,handleNewProductFieldChange:w,handleProductNameUpdate:u,handlePriceUpdate:p,handleStockUpdate:N,handleRemoveDiscount:y,handleAddDiscount:h,handleEditComplete:i,handleEditProduct:c,handleNewDiscountFieldChange:k,newDiscount:b,"data-testid":`product-${S+1}`},C.id))})]})},X=({newCoupon:t,handleAddCoupon:s,handleNewCouponFieldChange:a})=>e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("input",{type:"text",placeholder:"쿠폰 이름",value:t.name,onChange:n=>a("name",n.target.value),className:"w-full p-2 border rounded"}),e.jsx("input",{type:"text",placeholder:"쿠폰 코드",value:t.code,onChange:n=>a("code",n.target.value),className:"w-full p-2 border rounded"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:t.discountType,onChange:n=>a("discountType",n.target.value),className:"w-full p-2 border rounded",children:[e.jsx("option",{value:"amount",children:"금액(원)"}),e.jsx("option",{value:"percentage",children:"할인율(%)"})]}),e.jsx("input",{type:"number",placeholder:"할인 값",value:t.discountValue,onChange:n=>a("discountValue",parseInt(n.target.value)),className:"w-full p-2 border rounded"})]}),e.jsx("button",{onClick:s,className:"w-full bg-green-500 text-white p-2 rounded hover:bg-green-600",children:"쿠폰 추가"})]}),Y=({coupons:t})=>e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"현재 쿠폰 목록"}),e.jsx("div",{className:"space-y-2",children:t.map((s,a)=>e.jsxs("div",{"data-testid":`coupon-${a+1}`,className:"bg-gray-100 p-2 rounded",children:[s.name," (",s.code,"):",s.discountType==="amount"?`${s.discountValue}원`:`${s.discountValue}%`," ","할인"]},a))})]});function Z({onCouponAdd:t}){const[s,a]=g.useState({name:"",code:"",discountType:"percentage",discountValue:0});return{newCoupon:s,handleNewCouponFieldChange:(o,c)=>{a(u=>({...u,[o]:c}))},handleAddCoupon:()=>{t(s),a({name:"",code:"",discountType:"percentage",discountValue:0})}}}const ee=({onCouponAdd:t,coupons:s})=>{const{newCoupon:a,handleNewCouponFieldChange:n,handleAddCoupon:d}=Z({onCouponAdd:t});return e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"쿠폰 관리"}),e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsx(X,{newCoupon:a,handleAddCoupon:d,handleNewCouponFieldChange:n}),e.jsx(Y,{coupons:s})]})]})},te=({products:t,coupons:s,onProductUpdate:a,onProductAdd:n,onCouponAdd:d})=>e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"관리자 페이지"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(K,{products:t,onProductUpdate:a,onProductAdd:n}),e.jsx(ee,{onCouponAdd:d,coupons:s})]})]}),se=(t=[])=>{const[s,a]=g.useState(t);return{coupons:s,addCoupon:d=>{a(o=>[...o,d])}}},ne=(t=[])=>{const[s,a]=g.useState(t);return{products:s,updateProduct:o=>{a(c=>c.map(u=>u.id===o.id?o:u))},addProduct:o=>{a(c=>[...c,o])}}},ae=[{id:"p1",name:"상품1",price:1e4,stock:20,discounts:[{quantity:10,rate:.1},{quantity:20,rate:.2}]},{id:"p2",name:"상품2",price:2e4,stock:20,discounts:[{quantity:10,rate:.15}]},{id:"p3",name:"상품3",price:3e4,stock:20,discounts:[{quantity:10,rate:.2}]}],de=[{name:"5000원 할인 쿠폰",code:"AMOUNT5000",discountType:"amount",discountValue:5e3},{name:"10% 할인 쿠폰",code:"PERCENT10",discountType:"percentage",discountValue:10}],oe=()=>{const{products:t,updateProduct:s,addProduct:a}=ne(ae),{coupons:n,addCoupon:d}=se(de),[o,c]=g.useState(!1);return e.jsxs("div",{className:"min-h-screen bg-gray-100",children:[e.jsx("nav",{className:"bg-blue-600 text-white p-4",children:e.jsxs("div",{className:"container mx-auto flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"쇼핑몰 관리 시스템"}),e.jsx("button",{onClick:()=>c(!o),className:"bg-white text-blue-600 px-4 py-2 rounded hover:bg-blue-100",children:o?"장바구니 페이지로":"관리자 페이지로"})]})}),e.jsx("main",{className:"container mx-auto mt-6",children:o?e.jsx(te,{products:t,coupons:n,onProductUpdate:s,onProductAdd:a,onCouponAdd:d}):e.jsx(_,{products:t,coupons:n})})]})};q.createRoot(document.getElementById("root")).render(e.jsx(T.StrictMode,{children:e.jsx(oe,{})}));
